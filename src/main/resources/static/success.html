<script>
    const urlParams = new URLSearchParams(window.location.search);
    const paymentKey = urlParams.get("paymentKey");
    const orderId = urlParams.get("orderId");
    const amount = urlParams.get("amount");

    document.getElementById("params").textContent = JSON.stringify(
        { paymentKey, orderId, amount },
        null,
        2
    );

    async function confirmPayment() {
        if (!paymentKey || !orderId || !amount) {
            document.getElementById("confirmStatus").textContent =
                "âŒ URLì— paymentKey / orderId / amountê°€ ì—†ìŠµë‹ˆë‹¤.";
            document.getElementById("confirmStatus").className = "status-error";
            return;
        }

        try {
            const res = await fetch("/api/v1/payments/confirm/toss", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    paymentKey,
                    orderId,
                    amount: Number(amount)
                })
            });

            const json = await res.json().catch(() => ({}));

            if (res.ok) {
                document.getElementById("confirmStatus").textContent =
                    "âœ… ë°±ì—”ë“œ ê²°ì œ ê²€ì¦ ì„±ê³µ (HTTP 200)";
                document.getElementById("confirmStatus").className = "status-ok";

                // ğŸ’¡ì—¬ê¸°ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸!
                setTimeout(() => {
                    window.location.href = "https://api.thock.com/mypage";
                }, 1000); // í•„ìš”ì‹œ ë”œë ˆì´: UXì ìœ¼ë¡œ ì¢‹ìŒ
            } else {
                document.getElementById("confirmStatus").textContent =
                    "âŒ ë°±ì—”ë“œ ê²°ì œ ê²€ì¦ ì‹¤íŒ¨ (HTTP " + res.status + ")";
                document.getElementById("confirmStatus").className = "status-error";
            }

            document.getElementById("confirmResponse").textContent =
                JSON.stringify(json, null, 2);
        } catch (e) {
            document.getElementById("confirmStatus").textContent =
                "âŒ ë°±ì—”ë“œ ìš”ì²­ ì¤‘ ì—ëŸ¬: " + e.message;
            document.getElementById("confirmStatus").className = "status-error";
        }
    }

    confirmPayment();
</script>